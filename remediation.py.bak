from datetime import datetime
import requests
import json
from elasticsearch import Elasticsearch
import sys, os
sys.path.append(os.path.join(os.path.dirname(__file__), ".", "remediation"))
import actions.interface_down_remediation

class event:
    def __init__(self, device_ID, device_type, vendor, element_name, error_code, error_message, status, result):
        self.timestamp = datetime.now()
        self.device_ID = device_ID
        self.device_type = device_type
        self.vendor = vendor
        self.element_name = element_name
        self.error_code = error_code
        self.error_message = error_message
        self.status = status
        self.result = result
    def add_to_db(self):
        es = Elasticsearch([{'host': 'localhost', 'port': 9200}])
        #use vars() to convert obj to dic and add to elasticsearch
        es.index(index='events', body = vars(self))
    def take_remidation_action(self):
        print(self.error_code)
        if self.error_code == "interface_down":
            result = actions.interface_down_remediation.run()
        return result


event1 = event("vmx101", "network", "juniper", "ge-0/0/0", "interface_down", "ge-0/0/0 is down", "new", "new")
print(event)
print(event1.timestamp)
print(event1.device_ID)
event1.add_to_db()
print("check elasticsearch")
es_result = es.search(index="events", body={"query": {"match": {'device_ID':'vmx101'}}})
print(es_result)
event1.take_remidation_action()



